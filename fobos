[modes]
modes = fundal-test-nvf fundal-test-nvf-debug
        fundal-test-ifx
        fundal-test-gnu fundal-test-gnu-debug

# main modes
[fundal-test-nvf]
help     = Build FUNDAL tests with OpenACC-NVF
template = template-base-nvf

[fundal-test-nvf-debug]
help     = Build FUNDAL tests with OpenACC-NVF in debug mode
template = template-base-nvf-debug

[fundal-test-ifx]
help     = Build FUNDAL tests with OpenMP-IFX
template = template-base-ifx

[fundal-test-gnu]
help     = Build FUNDAL tests with OpenACC-GNU
template = template-base-gnu

[fundal-test-gnu-debug]
help     = Build FUNDAL tests with OpenACC-GNU in debug mode
template = template-base-gnu-debug

# templates
[template-base-nvf]
compiler  = nvfortran
preproc   = -DDEV_OAC -DCOMPILER_NVF
cflags    = -cpp -c -acc -gpu=cc70 -fast -Minfo=accel
lflags    = -acc -gpu=cc70 -fast -Minfo=accel
mod_dir   = ./mod/
obj_dir   = ./obj/
src       = ./src/
build_dir = ./exe/
colors    = True
quiet     = False
log       = True
jobs      = 4

[template-base-nvf-debug]
compiler  = nvfortran
preproc   = -DDEV_OAC -DCOMPILER_NVF
cflags    = -cpp -c -acc -gpu=cc70 -Minfo=accel -C -g
lflags    = -acc -gpu=cc70 -Minfo=accel -C -g
mod_dir   = ./mod/
obj_dir   = ./obj/
src       = ./src/
build_dir = ./exe/
colors    = True
quiet     = False
log       = True
jobs      = 4

[template-base-ifx]
compiler        = intel_nextgen
preproc         = -DDEV_OMP -DCOMPILER_IFX
cflags          = -c -cpp
lflags          = -cpp
openmp          = True
openmp_offload  = True
mod_dir         = ./mod/
obj_dir         = ./obj/
src             = ./src/
build_dir       = ./exe/
colors          = True
quiet           = False
log             = True
jobs            = 4

[template-base-gnu]
compiler  = gnu
preproc   = -DDEV_OAC -DCOMPILER_GNU
cflags    = -cpp -c -fopenacc
lflags    = -fopenacc
mod_dir   = ./mod/
obj_dir   = ./obj/
src       = ./src/
build_dir = ./exe/
colors    = True
quiet     = False
log       = True
jobs      = 4

[template-base-gnu-debug]
compiler  = gnu
preproc   = -DDEV_OAC -DCOMPILER_GNU
cflags    = -cpp -c -fopenacc -g -fcheck=all -fbacktrace
lflags    = -fopenacc -g -fcheck=all -fbacktrace
mod_dir   = ./mod/
obj_dir   = ./obj/
src       = ./src/
build_dir = ./exe/
colors    = True
quiet     = False
log       = True
jobs      = 4

# aux rules
[rule-run-tests]
help   = Run all tests
rule_1 = utils/run_tests.sh

[rule-build-run-tests-nvf]
help   = Build and Run all tests with OpenACC-NVF
rule_1 = FoBiS.py clean
rule_2 = FoBiS.py build -mode fundal-test-nvf
rule_3 = FoBiS.py rule -ex run-tests

[rule-build-run-tests-ifx]
help   = Build and Run all tests with OpenMP-IFX
rule_1 = FoBiS.py clean
rule_2 = FoBiS.py build -mode fundal-test-ifx
rule_3 = FoBiS.py rule -ex run-tests

[rule-makedoc]
help   = Build documentation from source files
rule_1 = rm -rf doc/html/*
rule_2 = ford doc/main_page.md --debug
rule_3 = cp -r doc/html/publish/* doc/html/
rule_4 = rm -rf doc/html/publish

[rule-deldoc]
help = Delete documentation
rule = rm -rf doc/html/*
